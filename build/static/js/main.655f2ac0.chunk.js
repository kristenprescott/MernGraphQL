(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{208:function(e,t,n){},218:function(e,t,n){"use strict";n.r(t);var a=n(76),s=n.n(a),c=n(0),r=n(31),o=n(18),i=n(238),l=(n(207),n(208),n(17)),j=n(58),d=n(176),b=n(3),u={user:null};if(localStorage.getItem("jwtoken")){var m=Object(d.a)(localStorage.getItem("jwtoken"));1e3*m.exp<Date.now()?localStorage.removeItem("jwtoken"):u.user=m}var O=Object(c.createContext)({user:null,login:function(e){},logout:function(){}});function h(e,t){switch(t.type){case"LOGIN":return Object(j.a)(Object(j.a)({},e),{},{user:t.payload});case"LOGOUT":return Object(j.a)(Object(j.a)({},e),{},{user:null});default:return e}}function x(e){var t=Object(c.useReducer)(h,u),n=Object(l.a)(t,2),a=n[0],s=n[1];return Object(b.jsx)(O.Provider,Object(j.a)({value:{user:a.user,login:function(e){localStorage.setItem("jwtoken",e.token),s({type:"LOGIN",payload:e}),console.log("LOGIN:"),console.log("token: ",e.token),console.log("userData: ",e)},logout:function(){localStorage.removeItem("jwtoken"),s({type:"LOGOUT"})}}},e))}var p=n(77),g=n(243),f=n(106),v=n(240);var C=function(e){var t=e.content,n=e.children;return Object(b.jsx)(v.a,{inverted:!0,content:t,trigger:n})};var w,y=function(){var e,t=Object(c.useContext)(O),n=t.user,a=t.logout,s=window.location.pathname,o="/"===s?"home":s.substr(1),i=Object(c.useState)(o),j=Object(l.a)(i,2),d=j[0],u=j[1],m=function(e,t){var n=t.name;u(n)};return n?Object(b.jsxs)(g.a,{attached:"top",tabular:!0,pointing:!0,secondary:!0,size:"massive",color:"red",children:[Object(b.jsx)(C,{content:"go to homepage",children:Object(b.jsxs)(g.a.Item,{as:r.b,to:"/",children:[Object(b.jsx)(f.a,{name:"home"}),Object(b.jsx)("h6",{children:"Home"})]})}),Object(b.jsxs)(g.a.Menu,{position:"right",children:[Object(b.jsx)(C,{content:"make a new post",children:Object(b.jsxs)(g.a.Item,(e={name:"newpost",as:r.b,to:"/newpost"},Object(p.a)(e,"name","newpost"),Object(p.a)(e,"children",[Object(b.jsx)(f.a,{name:"edit"}),Object(b.jsx)("h6",{children:"New Post"})]),e))}),n&&Object(b.jsx)(C,{content:"go to your profile page",children:Object(b.jsxs)(g.a.Item,{name:n.username,as:r.b,to:"/profile/".concat(n.id),children:[Object(b.jsx)(f.a,{name:"user"}),Object(b.jsx)("h6",{children:n.username})]})}),Object(b.jsx)(C,{content:"logout",children:Object(b.jsxs)(g.a.Item,{name:"logout",onClick:a,children:[Object(b.jsx)(f.a,{name:"arrow alternate circle right"}),Object(b.jsx)("h6",{children:"Logout"})]})})]})]}):Object(b.jsxs)(g.a,{attached:"top",tabular:!0,pointing:!0,secondary:!0,size:"massive",color:"red",children:[Object(b.jsx)(C,{content:"go to homepage",children:Object(b.jsxs)(g.a.Item,{name:"home",active:"home"===d,onClick:m,as:r.b,to:"/",children:[Object(b.jsx)(f.a,{name:"home"}),Object(b.jsx)("h6",{children:"Home"})]})}),Object(b.jsxs)(g.a.Menu,{position:"right",children:[Object(b.jsx)(C,{content:"",children:Object(b.jsxs)(g.a.Item,{name:"register",active:"register"===d,onClick:m,as:r.b,to:"/register",children:[Object(b.jsx)(f.a,{name:"user plus"}),Object(b.jsx)("h6",{children:"Register"})]})}),Object(b.jsx)(C,{content:"login",children:Object(b.jsxs)(g.a.Item,{name:"login",active:"login"===d,onClick:m,as:r.b,to:"/login",children:[Object(b.jsx)(f.a,{name:"user"}),Object(b.jsx)("h6",{children:"Login"})]})})]})]})},I=n(248),k=n(250),$=n(244),S=n(246),P=n(187),N=n(247),A=n(143),F=n(114),L=n.n(F),D=n(29),E=n(241),R=n(30);var Q,q,G,H,z=Object(R.a)(w||(w=Object(D.a)(["\n  mutation likePost($postId: ID!) {\n    likePost(postId: $postId) {\n      id\n      likes {\n        id\n        username\n      }\n      likeCount\n    }\n  }\n"]))),M=function(e){var t=e.user,n=e.post,a=n.id,s=n.likes,o=n.likeCount,i=Object(c.useState)(!1),j=Object(l.a)(i,2),d=j[0],u=j[1];Object(c.useEffect)((function(){t&&s.find((function(e){return e.username===t.username}))?u(!0):u(!1)}),[t,s]);var m=function(){window.location.reload()},O=Object(E.a)(z,{variables:{postId:a}}),h=Object(l.a)(O,1)[0],x=t?d?Object(b.jsx)(N.a,{onClick:m,color:"red",children:Object(b.jsx)(f.a,{name:"heart"})}):Object(b.jsx)(N.a,{onClick:m,color:"red",basic:!0,children:Object(b.jsx)(f.a,{name:"heart"})}):Object(b.jsx)(N.a,{as:r.b,to:"/login",color:"red",basic:!0,children:Object(b.jsx)(f.a,{name:"heart"})});return Object(b.jsx)(b.Fragment,{children:Object(b.jsx)(C,{content:d?"unlike post":"like post",children:Object(b.jsxs)(N.a,{as:"div",labelPosition:"right",onClick:h,children:[x,Object(b.jsx)(A.a,{basic:!0,color:"red",pointing:"left",children:o})]})})})},U=n(245),B=Object(R.a)(Q||(Q=Object(D.a)(["\n  {\n    getPosts {\n      id\n      username\n      title\n      body\n      tags\n      selectedFile\n      createdAt\n      likeCount\n      likes {\n        id\n        username\n        createdAt\n      }\n      commentCount\n      comments {\n        id\n        username\n        body\n        createdAt\n      }\n    }\n  }\n"])));Object(R.a)(q||(q=Object(D.a)(["\n  mutation createPost(\n    $title: String!\n    $body: String!\n    $tags: [String]\n    $selectedFile: String!\n  ) {\n    createPost(\n      title: $title\n      body: $body\n      tags: $tags\n      selectedFile: $selectedFile\n    ) {\n      id\n      title\n      username\n      body\n      tags\n      selectedFile\n      likeCount\n      likes {\n        id\n        username\n        createdAt\n      }\n      commentCount\n      comments {\n        id\n        username\n        body\n        createdAt\n      }\n      createdAt\n    }\n  }\n"])));var T=Object(R.a)(G||(G=Object(D.a)(["\n  mutation deletePost($postId: ID!) {\n    deletePost(postId: $postId)\n  }\n"]))),J=Object(R.a)(H||(H=Object(D.a)(["\n  mutation deleteComment($postId: ID!, $commentId: ID!) {\n    deleteComment(postId: $postId, commentId: $commentId) {\n      id\n      commentCount\n      comments {\n        id\n        username\n        body\n        createdAt\n      }\n    }\n  }\n"]))),V=function(e){var t=e.postId,n=e.commentId,a=e.callback,s=Object(c.useState)(!1),r=Object(l.a)(s,2),o=r[0],i=r[1],j=n?J:T,d=Object(E.a)(j,{update:function(e){if(i(!1),!n){var s=e.readQuery({query:B});s.getPosts=s.getPosts.filter((function(e){return e.id!==t})),e.writeQuery({query:B,data:s}),console.log("delete comment data: ",s)}a&&a()},variables:{postId:t,commentId:n}}),u=Object(l.a)(d,1)[0];return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)(C,{content:n?"delete comment":"delete post",children:Object(b.jsx)(N.a,{as:"div",color:"red",floated:"right",onClick:function(){i(!0)},children:Object(b.jsx)(f.a,{name:"trash",style:{margin:0}})})}),Object(b.jsx)(U.a,{open:o,onCancel:function(){i(!1)},onConfirm:u})]})};var K,W=function(e){var t=e.post,n=t.id,a=t.username,s=t.title,o=t.body,i=t.tags,l=t.selectedFile,j=t.likeCount,d=t.likes,u=t.commentCount,m=(t.comments,t.createdAt),h=Object(c.useContext)(O).user;return Object(b.jsxs)(S.a,{fluid:!0,style:{width:"100%",height:"100%"},children:[Object(b.jsxs)(S.a.Content,{children:[Object(b.jsx)(C,{content:a,children:Object(b.jsx)(P.a,{floated:"right",size:"mini",src:"https://react.semantic-ui.com/images/avatar/large/molly.png"})}),Object(b.jsxs)(S.a.Header,{children:[Object(b.jsx)(C,{content:"go to ".concat(a,"'s profile"),children:Object(b.jsxs)("div",{style:{cursor:"pointer"},children:[a," "]})}),Object(b.jsxs)(S.a.Meta,{as:r.b,to:"/posts/".concat(n),onClick:function(){console.log("postId: ","".concat(n))},children:[L()(m).fromNow(!0)," ago"]}),Object(b.jsx)("br",{}),Object(b.jsx)("br",{}),Object(b.jsx)("hr",{}),Object(b.jsx)(S.a.Content,{children:Object(b.jsxs)(S.a.Header,{children:[" ",Object(b.jsx)("h3",{onClick:function(){window.location.href="/posts/".concat(n)},style:{cursor:"pointer",margin:"0 auto",textAlign:"center"},children:s})]})}),Object(b.jsx)("hr",{})]}),Object(b.jsx)(S.a.Description,{children:o})]}),Object(b.jsx)(P.a,{src:l}),Object(b.jsx)("br",{}),Object(b.jsx)("hr",{}),Object(b.jsx)(S.a.Content,{extra:!0,children:i.map((function(e){return Object(b.jsxs)(S.a.Content,{className:"tags",as:r.b,to:"/tags/".concat(n),children:["#",e," "]},e)}))}),Object(b.jsxs)(S.a.Content,{extra:!0,children:[Object(b.jsx)(M,{user:h,post:{id:n,likes:d,likeCount:j}}),Object(b.jsx)(C,{content:"comment on post",children:Object(b.jsxs)(N.a,{labelPosition:"right",as:r.b,to:"/posts/".concat(n),children:[Object(b.jsx)(N.a,{color:"blue",basic:!0,children:Object(b.jsx)(f.a,{name:"comment"})}),Object(b.jsx)(A.a,{basic:!0,color:"blue",pointing:"left",children:u})]})}),h&&h.username===a&&Object(b.jsx)(V,{postId:n})]})]})},X=n(189),Y=n(242),Z=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(c.useState)(t),a=Object(l.a)(n,2),s=a[0],r=a[1],o=function(e){r(Object(j.a)(Object(j.a)({},s),{},Object(p.a)({},e.target.name,e.target.value)))},i=function(t){t.preventDefault(),e()};return{onChange:o,onSubmit:i,values:s}};var _=Object(R.a)(K||(K=Object(D.a)(["\n  mutation createPost(\n    $title: String!\n    $body: String!\n    $tags: [String]\n    $selectedFile: String!\n  ) {\n    createPost(\n      title: $title\n      body: $body\n      tags: $tags\n      selectedFile: $selectedFile\n    ) {\n      id\n      title\n      username\n      body\n      tags\n      selectedFile\n      likeCount\n      likes {\n        id\n        username\n        createdAt\n      }\n      commentCount\n      comments {\n        id\n        username\n        body\n        createdAt\n      }\n      createdAt\n    }\n  }\n"]))),ee=function(){var e=Z((function(){r({variables:{values:t}})}),{title:"",body:"",tags:[],selectedFile:""}),t=e.values,n=e.onChange,a=e.onSubmit,s=Object(E.a)(_,{variables:t,update:function(e,n){var a=e.readQuery({query:B});a.getPosts=[n.data.createPost].concat(Object(X.a)(a.getPosts)),e.writeQuery({query:B,data:a}),t.title="",t.body="",t.tags="",t.selectedFile=""}}),c=Object(l.a)(s,2),r=c[0],o=c[1].error;return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsxs)(Y.a,{onSubmit:a,children:[Object(b.jsx)("h2",{children:"Create a Post: "}),Object(b.jsxs)(Y.a.Field,{children:[Object(b.jsx)(Y.a.Input,{placeholder:"title",name:"title",onChange:n,value:t.title,error:!!o}),Object(b.jsx)(Y.a.Input,{style:{height:"250px"},placeholder:"body",name:"body",onChange:n,value:t.body,error:!!o}),Object(b.jsx)(Y.a.Input,{placeholder:"tags",name:"tags",onChange:n,value:t.tags,error:!!o}),Object(b.jsx)(Y.a.Input,{placeholder:"selectedFile",name:"selectedFile",onChange:n,value:t.selectedFile,error:!!o}),Object(b.jsx)(N.a,{type:"submit",color:"teal",children:"Submit"})]})]}),o&&Object(b.jsx)("div",{className:"ui error message",style:{marginBottom:20},children:Object(b.jsx)("ui",{className:"list",children:Object(b.jsx)("li",{children:o.graphQLErrors[0].message})})})]})};var te,ne=function(){var e=Object(c.useContext)(O).user,t=Object(I.a)(B),n=t.loading,a=t.data,s=(a=void 0===a?{}:a).getPosts;return Object(b.jsxs)(k.a,{columns:3,children:[Object(b.jsx)(k.a.Row,{className:"page-title",children:Object(b.jsx)("h1",{children:"Recent Posts"})}),Object(b.jsxs)(k.a.Row,{children:[e&&Object(b.jsx)(k.a.Column,{style:{display:"none"},children:Object(b.jsx)(ee,{})}),n?Object(b.jsx)("h1",{children:"Loading posts..."}):Object(b.jsx)($.a.Group,{children:s&&s.map((function(e){return Object(b.jsx)(k.a.Column,{style:{padding:"1rem"},children:Object(b.jsx)(W,{post:e})},e.id)}))})]})]})};var ae,se=Object(R.a)(te||(te=Object(D.a)(["\n  mutation login($username: String!, $password: String!) {\n    login(username: $username, password: $password) {\n      id\n      username\n      email\n      createdAt\n      token\n    }\n  }\n"]))),ce=function(e){var t=Object(c.useContext)(O),n=Object(c.useState)({}),a=Object(l.a)(n,2),s=a[0],r=a[1],o=Z((function(){h()}),{username:"",password:""}),i=o.onChange,j=o.onSubmit,d=o.values,u=Object(E.a)(se,{update:function(e,n){var a=n.data.login;console.log("login user data: ",a),t.login(a)},onError:function(e){r(e.graphQLErrors[0].extensions.errors)},variables:d}),m=Object(l.a)(u,2),h=m[0],x=m[1].loading;return Object(b.jsxs)("div",{className:"form-container",children:[Object(b.jsxs)(Y.a,{onSubmit:j,noValidate:!0,className:x?"loading":"",children:[Object(b.jsx)("h1",{className:"form-h1",children:"Login"}),Object(b.jsx)(Y.a.Input,{label:"Username",placeholder:"Enter username...",name:"username",type:"text",value:d.username,error:!!s.username,onChange:i}),Object(b.jsx)(Y.a.Input,{label:"Password",placeholder:"Enter password...",name:"password",type:"password",value:d.password,error:!!s.password,onChange:i})," ",Object(b.jsx)("div",{className:"btn-wrapper login-btn-wrapper",children:Object(b.jsx)(N.a,{className:"btn login-btn",type:"submit",primary:!0,children:"Login"})})]}),Object.keys(s).length>0&&Object(b.jsx)("div",{className:"ui error message",children:Object(b.jsx)("ul",{className:"list",children:Object.values(s).map((function(e){return Object(b.jsx)("li",{children:e},e)}))})})]})};var re,oe,ie=Object(R.a)(ae||(ae=Object(D.a)(["\n  mutation register(\n    $username: String!\n    $email: String!\n    $password: String!\n    $confirmPassword: String!\n  ) {\n    register(\n      registerInput: {\n        username: $username\n        email: $email\n        password: $password\n        confirmPassword: $confirmPassword\n      }\n    ) {\n      id\n      username\n      email\n      createdAt\n      token\n    }\n  }\n"]))),le=function(e){var t=Object(c.useContext)(O),n=Object(c.useState)({}),a=Object(l.a)(n,2),s=a[0],r=a[1],o=Z((function(){h()}),{username:"",email:"",password:"",confirmPassword:""}),i=o.onChange,j=o.onSubmit,d=o.values,u=Object(E.a)(ie,{update:function(n,a){var s=a.data.register;console.log("user registration data: ",s),t.login(s),e.history.push("/")},onError:function(e){r(e.graphQLErrors[0].extensions.errors)},variables:d}),m=Object(l.a)(u,2),h=m[0],x=m[1].loading;return Object(b.jsxs)("div",{className:"form-container",children:[Object(b.jsxs)(Y.a,{onSubmit:j,noValidate:!0,className:x?"loading":"",children:[Object(b.jsx)("h1",{className:"form-h1",children:"Register"}),Object(b.jsx)(Y.a.Input,{label:"Username",placeholder:"username",name:"username",value:d.username,error:!!s.username,onChange:i,type:"text"}),Object(b.jsx)(Y.a.Input,{label:"Email",placeholder:"email",name:"email",value:d.email,error:!!s.email,onChange:i,type:"email"})," ",Object(b.jsx)(Y.a.Input,{label:"Password",placeholder:"password",name:"password",value:d.password,error:!!s.password,onChange:i,type:"password"})," ",Object(b.jsx)(Y.a.Input,{label:"Confirm Password",placeholder:"confirm password",name:"confirmPassword",value:d.confirmPassword,error:!!s.confirmPassword,onChange:i,type:"password"}),Object(b.jsx)("div",{className:"btn-wrapper reg-btn-wrapper",children:Object(b.jsx)(N.a,{className:"btn reg-btn",type:"submit",primary:!0,children:"Submit"})})]}),Object.keys(s).length>0&&Object(b.jsx)("div",{className:"ui error message",children:Object(b.jsx)("ul",{className:"list",children:Object.values(s).map((function(e){return Object(b.jsx)("li",{children:e},e)}))})})]})};var je=Object(R.a)(re||(re=Object(D.a)(["\n  mutation($postId: String!, $body: String!) {\n    createComment(postId: $postId, body: $body) {\n      id\n      username\n      commentCount\n      comments {\n        id\n        username\n        body\n        createdAt\n      }\n      createdAt\n    }\n  }\n"]))),de=Object(R.a)(oe||(oe=Object(D.a)(["\n  query($postId: ID!) {\n    getPost(postId: $postId) {\n      id\n      username\n      title\n      body\n      tags\n      selectedFile\n      username\n      likeCount\n      likes {\n        username\n      }\n      commentCount\n      comments {\n        id\n        username\n        body\n        createdAt\n      }\n      createdAt\n    }\n  }\n"]))),be=function(e){var t,n=e.match.params.postId,a=Object(c.useContext)(O).user,s=Object(c.useRef)(null),o=Object(c.useState)(""),i=Object(l.a)(o,2),j=i[0],d=i[1],u=Object(I.a)(de,{variables:{postId:n}}).data,m=(u=void 0===u?{}:u).getPost,h=Object(E.a)(je,{update:function(){d(""),s.current.blur(),window.location.reload()},variables:{postId:n,body:j}}),x=Object(l.a)(h,1)[0];if(m){var p=m.id,g=m.username,v=m.title,w=m.body,y=m.tags,$=m.selectedFile,F=m.likeCount,D=m.likes,R=m.commentCount,Q=m.comments,q=m.createdAt;t=Object(b.jsx)(k.a,{children:Object(b.jsxs)(k.a.Row,{children:[Object(b.jsx)(k.a.Column,{width:3,children:Object(b.jsx)(P.a,{src:"https://react.semantic-ui.com/images/avatar/large/molly.png",size:"small",float:"right"})}),Object(b.jsxs)(k.a.Column,{width:9,children:[Object(b.jsxs)(S.a,{fluid:!0,children:[Object(b.jsxs)(S.a.Content,{children:[Object(b.jsxs)(S.a.Header,{children:[g," ",Object(b.jsxs)(S.a.Meta,{children:[L()(q).fromNow()," ago"]}),Object(b.jsx)("br",{}),Object(b.jsx)("br",{}),Object(b.jsx)("hr",{}),Object(b.jsx)("h3",{style:{margin:"0 auto",textAlign:"center"},children:Object(b.jsx)(S.a.Content,{header:v})}),Object(b.jsx)("hr",{})]}),Object(b.jsx)(S.a.Description,{children:w})]}),Object(b.jsx)(P.a,{src:$}),Object(b.jsx)(S.a.Content,{extra:!0,children:y.map((function(e){return Object(b.jsxs)(S.a.Content,{className:"tags",as:r.b,to:"/tags/".concat(p),children:["#",e," "]},e)}))}),Object(b.jsx)("hr",{}),Object(b.jsxs)(S.a.Content,{extra:!0,children:[Object(b.jsx)(M,{user:a,post:{id:p,likeCount:F,likes:D}}),Object(b.jsx)(C,{content:"comment on post",children:Object(b.jsxs)(N.a,{as:"div",labelPosition:"right",onClick:function(){s.current.focus(),console.log("comment on post")},children:[Object(b.jsx)(N.a,{basic:!0,color:"blue",children:Object(b.jsx)(f.a,{name:"comments"})}),Object(b.jsx)(A.a,{basic:!0,color:"blue",pointing:"left",children:R})]})}),a&&a.username===g&&Object(b.jsx)(V,{postId:p,callback:function(){window.location.href="/"}})]})]}),a&&Object(b.jsx)(S.a,{fluid:!0,children:Object(b.jsxs)(S.a.Content,{children:[Object(b.jsx)("h3",{children:"Post a comment:"}),Object(b.jsx)(Y.a,{children:Object(b.jsxs)("div",{className:"ui action input fluid",children:[Object(b.jsx)("input",{type:"text",placeholder:"comment...",name:"comment",value:j,onChange:function(e){return d(e.target.value)},ref:s}),Object(b.jsx)("button",{type:"submit",className:"ui button teal",disabled:""===j.trim(),onClick:x,children:"Submit"})]})})]})}),Object(b.jsx)(S.a,{fluid:!0,children:Q.map((function(e){return Object(b.jsxs)(S.a.Content,{children:[a&&a.username===e.username&&Object(b.jsx)(V,{postId:p,commentId:e.id}),Object(b.jsx)(S.a.Header,{children:e.username}),Object(b.jsx)(S.a.Meta,{children:L()(e.createdAt).fromNow()}),Object(b.jsx)(S.a.Description,{children:e.body})]},e.id)}))})]}),Object(b.jsx)(k.a.Column,{width:3,style:{height:"100%",border:"1px solid gainsboro",borderTop:"none",marginLeft:"5%"}})]})})}else t=Object(b.jsx)("p",{children:"Loading post.."});return t};var ue=function(){return Object(b.jsx)(x,{children:Object(b.jsx)(r.a,{children:Object(b.jsx)(i.a,{children:Object(b.jsxs)("div",{className:"ui container",children:[Object(b.jsx)(y,{}),Object(b.jsx)(o.a,{exact:!0,path:"/",component:ne}),Object(b.jsx)(o.a,{exact:!0,path:"/newpost",component:ee}),Object(b.jsx)(o.a,{exact:!0,path:"/login",component:ce}),Object(b.jsx)(o.a,{exact:!0,path:"/register",component:le}),Object(b.jsx)(o.a,{exact:!0,path:"/posts/:postId",component:be})]})})})})},me=n(184),Oe=n(188),he=n(190),xe=n(239),pe=n(183),ge=Object(he.a)({uri:"".concat("https://merngraphql-server.herokuapp.com/")}),fe=Object(pe.a)((function(){var e=localStorage.getItem("jwtoken");return{headers:{Authorization:e?"Bearer ".concat(e):""}}})),ve=new me.a({link:fe.concat(ge),cache:new Oe.a}),Ce=Object(b.jsx)(xe.a,{client:ve,children:Object(b.jsx)(ue,{})});s.a.render(Ce,document.getElementById("root"))}},[[218,1,2]]]);
//# sourceMappingURL=main.655f2ac0.chunk.js.map